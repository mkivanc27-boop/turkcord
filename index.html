<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TurkCord PRO</title>

<style>
body{
margin:0;
background:#0f0f12;
color:white;
font-family:Arial;
}

/* AUTH */

.auth{
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
gap:10px;
}

input{
padding:8px;
border-radius:6px;
border:none;
background:#1c1c21;
color:white;
}

button{
padding:8px 12px;
border:none;
border-radius:6px;
background:#5865f2;
color:white;
cursor:pointer;
}

/* APP */

#app{
display:none;
height:100vh;
}

/* LAYOUT */

.layout{
display:flex;
height:100%;
}

/* SERVER SIDEBAR */

#servers{
width:70px;
background:#111214;
display:flex;
flex-direction:column;
align-items:center;
padding-top:10px;
gap:10px;
overflow-y:auto;
}

.serverCircle{
width:45px;
height:45px;
border-radius:50%;
background:#5865f2;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
font-weight:bold;
}

/* CHANNEL */

#channels{
width:230px;
background:#1e1f22;
padding:10px;
overflow-y:auto;
}

/* CHAT */

#chat{
flex:1;
display:flex;
flex-direction:column;
padding:15px;
}

#messages{
flex:1;
overflow-y:auto;
}

.message{
padding:6px;
background:#2b2d31;
border-radius:6px;
margin-bottom:6px;
}

/* FRIEND */

.friendBox{
background:#2b2d31;
padding:6px;
border-radius:6px;
margin-bottom:5px;
cursor:pointer;
}
</style>
</head>
<body>

<!-- AUTH -->

<div id="auth" class="auth">
<h2>Login</h2>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Åžifre">
<button onclick="login()">GiriÅŸ</button>
<p onclick="showRegister()" style="color:#5865f2;cursor:pointer;">KayÄ±t Ol</p>
</div>

<div id="register" class="auth" style="display:none;">
<h2>KayÄ±t</h2>
<input id="regUsername" placeholder="Nick">
<input id="regEmail" placeholder="Email">
<input id="regPass" type="password" placeholder="Åžifre">
<button onclick="register()">KayÄ±t</button>
<p onclick="showLogin()" style="color:#5865f2;cursor:pointer;">Geri</p>
</div>

<!-- APP -->

<div id="app">

<div class="layout">

<div id="servers"></div>

<div id="channels">
<h3>ArkadaÅŸ</h3>
<input id="friendNick" placeholder="Nick">
<button onclick="sendFriendRequest()">Ekle</button>

<h4>Ä°stekler</h4>
<div id="friendRequests"></div>

<h4>ArkadaÅŸlar</h4>
<div id="friendList"></div>
</div>

<div id="chat">

<h2 id="chatTitle">TurkCord</h2>
<div id="messages"></div>

<div style="display:flex;gap:10px;">
<input id="messageInput" placeholder="Mesaj yaz">
<button onclick="sendMessage()">GÃ¶nder</button>
</div>

</div>

</div>
</div>
<script type="module">

/* ================= FIREBASE ================= */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, setDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"API_KEY_YAZ",
authDomain:"turkcord-47b24.firebaseapp.com",
projectId:"turkcord-47b24",
storageBucket:"turkcord-47b24.firebasestorage.app",
messagingSenderId:"474688300925",
appId:"1:474688300925:web:75d8d4c690b92c7d438e14"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let selectedServer=null;
let selectedChannel=null;
let selectedFriend=null;

/* ================= AUTH ================= */

window.register = async()=>{

// Username unique kontrol

const usernameCheck = await getDocs(
query(collection(db,"usernames"),where("__name__","==",regUsername.value))
);

if(!usernameCheck.empty){
alert("Username alÄ±nmÄ±ÅŸ âŒ");
return;
}

const user = await createUserWithEmailAndPassword(
auth,
regEmail.value,
regPass.value
);

// users
await setDoc(doc(db,"users",user.user.uid),{
username:regUsername.value,
email:regEmail.value
});

// usernames
await setDoc(doc(db,"usernames",regUsername.value),{
uid:user.user.uid
});

alert("KayÄ±t baÅŸarÄ±lÄ± âœ…");

};

window.login = async()=>{

await signInWithEmailAndPassword(
auth,
loginEmail.value,
loginPass.value
);

auth.style.display="none";
register.style.display="none";
app.style.display="block";

loadServers();
loadFriends();

};

window.logout = async()=>{
await signOut(auth);
location.reload();
};

window.showRegister=()=>{
auth.style.display="none";
register.style.display="flex";
};

window.showLogin=()=>{
register.style.display="none";
auth.style.display="flex";
};

/* ================= GLOBAL ADMIN CHECK ================= */

let isAdmin=false;

async function checkAdmin(){

const snap = await getDocs(collection(db,"globalAdmins"));

snap.forEach(docSnap=>{
if(docSnap.id === auth.currentUser.uid){
isAdmin=true;
}
});

}

/* ================= SERVER ================= */

function loadServers(){

onSnapshot(collection(db,"servers"),snap=>{

servers.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.className="serverCircle";
div.innerText=data.name.charAt(0);

div.onclick=()=>{
selectedServer=docSnap.id;
chatTitle.innerText=data.name;
loadChannels();
};

servers.appendChild(div);

});

/* CREATE SERVER BUTTON */

const add=document.createElement("div");
add.className="serverCircle";
add.innerText="+";

add.onclick=async()=>{

const name=prompt("Server adÄ±");
if(!name) return;

await addDoc(collection(db,"servers"),{
name:name,
owner:auth.currentUser.uid
});

};

servers.appendChild(add);

});

}

/* ================= CHANNEL ================= */

function loadChannels(){

onSnapshot(collection(db,"servers",selectedServer,"channels"),snap=>{

channels.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.className="friendBox";
div.innerText="# "+data.name;

div.onclick=()=>{
selectedChannel=docSnap.id;
loadMessages();
};

channels.appendChild(div);

});

});

}

window.sendMessage=async()=>{

if(!selectedServer || !selectedChannel) return;

await addDoc(
collection(db,"servers",selectedServer,"channels",selectedChannel,"messages"),
{
text:messageInput.value,
sender:auth.currentUser.uid,
time:Date.now()
}
);

messageInput.value="";

};

function loadMessages(){

onSnapshot(
collection(db,"servers",selectedServer,"channels",selectedChannel,"messages"),
snap=>{

messages.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.className="message";
div.innerText=data.text;

messages.appendChild(div);

});

});

}

/* ================= FRIEND SYSTEM ================= */

window.sendFriendRequest = async()=>{

const nick = friendNick.value;

const q = query(collection(db,"users"),where("username","==",nick));
const snap = await getDocs(q);

if(snap.empty){
alert("KullanÄ±cÄ± bulunamadÄ±");
return;
}

const targetUID = snap.docs[0].id;

await addDoc(collection(db,"friendRequests"),{
from:auth.currentUser.uid,
to:targetUID,
status:"pending"
});

};

function loadFriends(){

onSnapshot(collection(db,"friendRequests"),snap=>{

friendRequests.innerHTML="";
friendList.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

/* REQUEST */

if(data.to===auth.currentUser.uid && data.status==="pending"){

const div=document.createElement("div");
div.className="friendBox";
div.innerHTML=`
<p>${data.from}</p>
<button onclick="acceptFriend('${docSnap.id}','${data.from}')">âœ”</button>
<button onclick="rejectFriend('${docSnap.id}')">âœ–</button>
`;

friendRequests.appendChild(div);

}

/* FRIEND LIST */

if(data.status==="accepted"){

if(data.from===auth.currentUser.uid || data.to===auth.currentUser.uid){

const friendId = data.from===auth.currentUser.uid ? data.to : data.from;

const div=document.createElement("div");
div.className="friendBox";
div.innerText="ðŸ’™ "+friendId;

div.onclick=()=>{
selectedFriend=friendId;
chatTitle.innerText="DM - "+friendId;
loadDM();
};

friendList.appendChild(div);

}

}

});

});

}

window.acceptFriend=async(id,from)=>{

await setDoc(doc(db,"friendRequests",id),{
status:"accepted"
},{merge:true});

await setDoc(doc(db,"friends",auth.currentUser.uid),{
list:[from]
},{merge:true});

await setDoc(doc(db,"friends",from),{
list:[auth.currentUser.uid]
},{merge:true});

};

window.rejectFriend=async(id)=>{
await setDoc(doc(db,"friendRequests",id),{
status:"rejected"
},{merge:true});
};

/* ================= DM ================= */

window.sendDM=async()=>{

if(!selectedFriend) return;

await addDoc(collection(db,"dms"),{
from:auth.currentUser.uid,
to:selectedFriend,
text:messageInput.value,
time:Date.now()
});

messageInput.value="";

};

function loadDM(){

onSnapshot(collection(db,"dms"),snap=>{

messages.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

if(
(data.from===auth.currentUser.uid && data.to===selectedFriend) ||
(data.to===auth.currentUser.uid && data.from===selectedFriend)
){

const div=document.createElement("div");
div.className="message";
div.innerText=data.text;

messages.appendChild(div);

}

});

});

}

</script>

</body>
</html>
</script>

</body>
</html>
