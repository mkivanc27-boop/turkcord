<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TurkCord Final</title>

<style>
body{
margin:0;
background:#1e1f22;
color:white;
font-family:sans-serif;
}

/* AUTH */

.authBox{
height:100vh;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
gap:10px;
}

/* LAYOUT */

#appLayout{
display:flex;
height:100vh;
}

/* SERVER SIDEBAR */

#servers{
width:80px;
background:#111214;
display:flex;
flex-direction:column;
align-items:center;
gap:10px;
padding-top:10px;
overflow-y:auto;
}

.serverCircle{
width:50px;
height:50px;
border-radius:50%;
background:#5865f2;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
font-weight:bold;
}

.serverCircle.active{
border:3px solid #00aaff;
}

/* CHANNEL */

#channels{
width:250px;
background:#2b2d31;
padding:10px;
overflow-y:auto;
}

.channelItem{
padding:6px;
background:#3a3c41;
margin-top:6px;
border-radius:6px;
cursor:pointer;
}

/* CHAT */

#chat{
flex:1;
display:flex;
flex-direction:column;
padding:20px;
}

input{
padding:8px;
border-radius:6px;
border:none;
background:#2b2d31;
color:white;
}

button{
padding:8px 12px;
border:none;
border-radius:6px;
background:#5865f2;
color:white;
cursor:pointer;
}
</style>

</head>
<body>

<!-- ================= AUTH ================= -->

<div id="authScreen" class="authBox">

<h2>Login</h2>

<input id="loginEmail" placeholder="Email">
<input id="loginPassword" type="password" placeholder="Şifre">
<button onclick="login()">Giriş</button>

<p>
Hesabın yok mu?
<span onclick="showRegister()" style="color:#5865f2;cursor:pointer;">
Kayıt Ol
</span>
</p>

</div>

<div id="registerScreen" class="authBox" style="display:none;">

<h2>Kayıt</h2>

<input id="registerUsername" placeholder="Kullanıcı Adı">
<input id="registerEmail" placeholder="Email">
<input id="registerPassword" type="password" placeholder="Şifre">

<button onclick="register()">Kayıt Ol</button>

<p onclick="showLogin()" style="color:#5865f2;cursor:pointer;">
Geri
</p>

</div>

<!-- ================= APP ================= -->

<div id="app" style="display:none;">

<div id="appLayout">

<div id="servers"></div>

<div id="channels">
<h3>Kanallar</h3>
<div id="channelList"></div>
<button onclick="createChannel()">+ Kanal</button>
</div>

<div id="chat">

<h2 id="serverName">Server</h2>
<h4 id="channelName"></h4>

<div id="messages" style="flex:1;overflow-y:auto;"></div>

<div style="display:flex;gap:10px;">
<input id="messageInput" placeholder="Mesaj yaz...">
<button onclick="sendMessage()">Gönder</button>
</div>

</div>

</div>

</div>

<script type="module">

/* FIREBASE */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyC98wxJQk8yNZFdE-OJ1Tlpy1ANuaRUT14",
authDomain:"turkcord-47b24.firebaseapp.com",
projectId:"turkcord-47b24",
storageBucket:"turkcord-47b24.firebasestorage.app",
messagingSenderId:"474688300925",
appId:"1:474688300925:web:75d8d4c690b92c7d438e14"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let selectedServer = null;
let selectedChannel = null;

/* ================= AUTH ================= */

window.register = async()=>{

const user = await createUserWithEmailAndPassword(
auth,
registerEmail.value,
registerPassword.value
);

await setDoc(doc(db,"users",user.user.uid),{
username:registerUsername.value
});

alert("Kayıt başarılı");

};

window.login = async()=>{

await signInWithEmailAndPassword(
auth,
loginEmail.value,
loginPassword.value
);

authScreen.style.display="none";
app.style.display="block";

loadServers();

};

window.showRegister=()=>{
authScreen.style.display="none";
registerScreen.style.display="flex";
};

window.showLogin=()=>{
registerScreen.style.display="none";
authScreen.style.display="flex";
};

/* ================= SERVERS ================= */

function loadServers(){

onSnapshot(collection(db,"servers"),snap=>{

servers.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.className="serverCircle";
div.innerText=data.name.charAt(0);

div.onclick=()=>{
selectedServer=docSnap.id;
serverName.innerText=data.name;
loadChannels();
};

servers.appendChild(div);

});

/* + */

const add=document.createElement("div");
add.className="serverCircle";
add.innerText="+";

add.onclick=async()=>{
const name=prompt("Server adı");
if(!name) return;

await addDoc(collection(db,"servers"),{
name:name,
owner:auth.currentUser.uid
});
};

servers.appendChild(add);

});

}

/* ================= CHANNEL ================= */

window.createChannel=async()=>{
if(!selectedServer) return;

const name=prompt("Kanal adı");
if(!name) return;

await addDoc(collection(db,"servers",selectedServer,"channels"),{
name:name
});

};

function loadChannels(){

onSnapshot(collection(db,"servers",selectedServer,"channels"),snap=>{

channelList.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.className="channelItem";
div.innerText="# "+data.name;

div.onclick=()=>{
selectedChannel=docSnap.id;
channelName.innerText="# "+data.name;
loadMessages();
};

channelList.appendChild(div);

});

});

}

/* ================= CHAT ================= */

window.sendMessage=async()=>{

if(!selectedServer || !selectedChannel) return;

const text=messageInput.value;
if(!text) return;

await addDoc(
collection(db,"servers",selectedServer,"channels",selectedChannel,"messages"),
{
text:text,
sender:auth.currentUser.uid,
time:Date.now()
}
);

messageInput.value="";

};

function loadMessages(){

onSnapshot(
collection(db,"servers",selectedServer,"channels",selectedChannel,"messages"),
snap=>{

messages.innerHTML="";

snap.forEach(docSnap=>{

const data=docSnap.data();

const div=document.createElement("div");
div.style.padding="6px";
div.innerText=data.text;

messages.appendChild(div);

});

});

}

</script>

</body>
</html>
